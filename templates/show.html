<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>数据分析图表展示</title>
    <link rel="stylesheet" type="text/css" href="../static/css/mdui.min.css"/>
    <script src="../static/webjs/mdui.min.js"></script>
    <script src="../static/webjs/jquery-3.3.1.min.js"></script>
    {% for jsfile_name in script_list %}
        <script src="{{ host }}/{{ jsfile_name }}.js"></script>
    {% endfor %}
    <style>
        .card { padding-top: 25px; padding-left: 20px; display: inline-block; position: relative !important; margin: 20px 20px 0 30px; border-radius: 10px; float: left; overflow: hidden; height: 500px; }
    </style>
</head>
<body>
<div class="navbar"> <a href="/" class="nav-button">返回主页</a> </div>
<div class="mdui-tab mdui-color-cyan" mdui-tab style="font-weight: 600; color: white!important; letter-spacing: 0.2em; height:50px;">
    <a href="#tab-overview" class="mdui-ripple mdui-tab-active">市场总览</a>
    <a href="#tab-jobs" class="mdui-ripple">岗位洞察</a>
    <a href="#tab-salary" class="mdui-ripple">薪酬解密</a>
    <a href="#tab-requirements" class="mdui-ripple">人才需求</a>
</div>
<div id="tab-overview" class="mdui-p-a-2">
    <div class="mdui-card card" id="chart-container-1" style="width: 45%;"></div>
    <div class="mdui-card card" id="chart-container-2" style="width: 45%;"></div>
    <div class="mdui-card card" id="chart-container-3" style="width: 92%;"></div>
</div>
<div id="tab-jobs" class="mdui-p-a-2">
    <div class="mdui-card card" id="chart-container-4" style="width: 45%;"></div>
    <div class="mdui-card card" id="chart-container-5" style="width: 45%;"></div>
    <div class="mdui-card card" id="chart-container-6" style="width: 45%;"></div>
    <div class="mdui-card card" id="chart-container-7" style="width: 92%; height: 600px;"></div>
</div>
<div id="tab-salary" class="mdui-p-a-2">
    <div class="mdui-card card" id="chart-container-8" style="width: 45%;"></div>
    <div class="mdui-card card" id="chart-container-9" style="width: 45%;"></div>
    <div class="mdui-card card" id="chart-container-10" style="width: 45%;"></div>
    <div class="mdui-card card" id="chart-container-11" style="width: 45%;"></div>
</div>
<div id="tab-requirements" class="mdui-p-a-2">
    <div class="mdui-card card" id="chart-container-12" style="width: 45%;"></div>
    <div class="mdui-card card" id="chart-container-13" style="width: 45%;"></div>
    <div class="mdui-card card" id="chart-container-14" style="width: 92%; height: 600px;"></div>
</div>
</body>
<style>
    .navbar { position: fixed; top: 0; left: 0; width: 100%; background-color: #333; padding: 10px 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); z-index: 1000; box-sizing: border-box; }
    .nav-button { color: white; text-decoration: none; padding: 8px 15px; border-radius: 5px; transition: background-color 0.3s; }
    .nav-button:hover { background-color: #555; }
    body { padding-top: 60px; }
</style>
<script>
    const chartMap = JSON.parse('{{ chart_map_json | safe }}');
    const chartConfigByName = {
        '#tab-overview': [
            'f16_top10_demand_cities',
            'f2_top10_industry_demand',
            'f22_company_type_distribution'
        ],
        '#tab-jobs': [
            'f1_emerging_vs_traditional_salary',
            'f18_emerging_job_proportion',
            'f14_top10_salary_directions',
            'f3_top_jobs_city_demand_heatmap'
        ],
        '#tab-salary': [
            'f4_top10_salary_cities',
            'f7_education_salary_demand_scatter',
            'f12_experience_salary_demand_3dscatter',
            'f11_top10_experience_required_jobs'
        ],
        '#tab-requirements': [
            'f23_education_demand',
            'f24_experience_demand',
            'f10_emerging_vs_traditional_requirements',
            'f6_edu_exp_salary_3dbar'
        ]
    };
    function loadCharts(tabId) {
        const chartNames = chartConfigByName[tabId];
        if (!chartNames) return;
        console.log(`Loading charts for tab: ${tabId}`);
        $(chartNames).each(function(index, chartName) {
            const chartId = chartMap[chartName];
            const containerSelector = `${tabId} #chart-container-${index + 1}`;
            if (chartId === undefined) {
                console.error(`Chart name "${chartName}" not found in chartMap.`);
                $(containerSelector).html(`<p style="color:red; text-align:center;">图表配置错误: 未找到 ${chartName}</p>`);
                return;
            }
            const chartUrl = `/chart/${chartId}`;
            if ($(containerSelector).data('loaded')) return;
            $.ajax({
                type: "GET",
                url: chartUrl,
                dataType: "html",
                success: function (data) {
                    $(containerSelector).html(data).data('loaded', true);
                },
                error: function (e) {
                    console.error(`Error loading chart ${chartId} (${chartName}) into ${containerSelector}:`, e);
                    $(containerSelector).html(`<p style="color:red; text-align:center;">图表加载失败 (ID: ${chartId})</p>`);
                }
            });
        });
    }
    $(document).ready(function() {
        const initialTab = $('.mdui-tab-active').attr('href');
        loadCharts(initialTab);
        $('.mdui-tab a').on('click', function() {
            const tabId = $(this).attr('href');
            loadCharts(tabId);
        });
    });
</script>
</html>